{% extends "base.html" %}

{% block title %}פרטי הזמנה #{{ order.customer_order_number }} - FLYTAU{% endblock %}

{% block content %}
<div class="order-details-container">
    <h1>פרטי הזמנה #{{ order.customer_order_number }}</h1>

    <div class="order-info">
        <h2>פרטי הזמנה</h2>
        <div class="info-grid">
            <div class="info-item">
                <strong>סטטוס</strong>
                <span class="status-badge status-{{ order.order_status.lower().replace('_', '-') }}">
                    {% if order.order_status == 'Active' %}פעילה
                    {% elif order.order_status == 'Completed' %}הושלמה
                    {% elif order.order_status == 'Canceled_By_Client' %}בוטלה ע"י הלקוח
                    {% elif order.order_status == 'Canceled_By_Company' %}בוטלה ע"י החברה
                    {% else %}{{ order.order_status }}{% endif %}
                </span>
            </div>
            <div class="info-item">
                <strong>תאריך הזמנה</strong>
                <span>{{ order.order_date.strftime('%d/%m/%Y %H:%M') }}</span>
            </div>
            <div class="info-item">
                <strong>סכום כולל</strong>
                <span>{{ "%.2f"|format(order.total_payment) }} ₪</span>
            </div>
            <div class="info-item">
                <strong>שם הנוסע</strong>
                <span>{{ order.first_name_english }} {{ order.last_name_english }}</span>
            </div>
        </div>
    </div>

    <div class="flight-info">
        <h2>פרטי טיסה</h2>
        <div class="info-grid">
            <div class="info-item">
                <strong>מסלול</strong>
                <span>{{ order.origin_airport }} → {{ order.destination_airport }}</span>
            </div>
            <div class="info-item">
                <strong>תאריך ושעה</strong>
                <span>{{ order.departure_datetime.strftime('%d/%m/%Y %H:%M') }}</span>
            </div>
            <div class="info-item">
                <strong>סטטוס טיסה</strong>
                <span>
                    {% if order.flight_status == 'Active' %}פעילה
                    {% elif order.flight_status == 'Full' %}מלאה
                    {% elif order.flight_status == 'Landed' %}נחתה
                    {% elif order.flight_status == 'Canceled' %}בוטלה
                    {% else %}{{ order.flight_status }}{% endif %}
                </span>
            </div>
        </div>
    </div>

    <div class="tickets-info">
        <h2>כרטיסים ({{ tickets|length }})</h2>
        {% if tickets %}
        <table class="tickets-table">
            <thead>
                <tr>
                    <th>מחלקה</th>
                    <th>מושב</th>
                    <th>מחיר</th>
                </tr>
            </thead>
            <tbody>
                {% for ticket in tickets %}
                    <tr>
                        <td>{{ 'עסקים' if ticket.class_type == 'Business' else 'תיירים' }}</td>
                        <td>{{ ticket.seat_number }}</td>
                        <td>{{ "%.2f"|format(ticket.price) }} ₪</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <p class="no-results">לא נמצאו כרטיסים</p>
        {% endif %}
    </div>

    <div class="order-actions">
        {% if order.order_status == 'Active' %}
            <form method="POST" action="{{ url_for('orders.cancel', order_id=order.order_id) }}"
                  onsubmit="return confirm('האם אתה בטוח שברצונך לבטל הזמנה זו? דמי ביטול: 5% מהמחיר המקורי');">
                <button type="submit" class="btn-danger">בטל הזמנה</button>
            </form>
        {% endif %}
        <a href="{{ url_for('orders.list') }}" class="btn-secondary">חזרה לרשימת הזמנות</a>
    </div>
</div>
{% endblock %}




