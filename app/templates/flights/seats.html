{% extends "base.html" %}

{% block title %}בחירת מושבים - FLYTAU{% endblock %}

{% block content %}
<div class="seats-container">
    <h1>בחירת מושבים</h1>

    <div class="flight-info">
        <h2>פרטי הטיסה</h2>
        <p><strong>מסלול:</strong> {{ flight.origin_airport }} → {{ flight.destination_airport }}</p>
        <p><strong>תאריך ושעה:</strong> {{ flight.departure_datetime.strftime('%d/%m/%Y %H:%M') }}</p>
        <p><strong>משך טיסה:</strong> {{ flight.flight_duration }} שעות</p>
        <p><strong>מטוס:</strong> {{ flight.manufacturer }} ({{ flight.size_category }})</p>
    </div>

    <form method="POST" action="{{ url_for('orders.create') }}" id="seat-selection-form">
        <input type="hidden" name="flight_id" value="{{ flight.flight_id }}">
        <input type="hidden" name="plane_id" value="{{ flight.plane_id }}">

        {% for class_type, seats in seats_by_class.items() %}
            <div class="class-section">
                <h3>מחלקה: {{ class_type }}</h3>
                <div class="seats-grid">
                    {% for seat in seats %}
                        <label class="seat-label {% if not seat.available %}seat-occupied{% endif %}">
                            <input type="checkbox"
                                   name="seats"
                                   value="{{ seat.plane_id }},{{ seat.class_type }},{{ seat.seat_number }}"
                                   {% if not seat.available %}disabled{% endif %}
                                   data-price="{{ flight.price_business if seat.class_type == 'Business' else flight.price_economy }}">
                            <span class="seat-number">{{ seat.seat_number }}</span>
                            {% if not seat.available %}
                                <span class="seat-status">תפוס</span>
                            {% endif %}
                        </label>
                    {% endfor %}
                </div>
            </div>
        {% endfor %}

        <div class="order-summary">
            <h3>סיכום הזמנה</h3>
            <p>מספר מושבים נבחרים: <span id="selected-count">0</span></p>
            <p>סכום כולל: <span id="total-price">0.00</span> ₪</p>
        </div>

        {% if not session.user_email %}
        <div class="guest-info" style="background: #f8f9fa; padding: 1.5rem; border-radius: 8px; margin: 1.5rem 0;">
            <h3>פרטי המזמין (אורח)</h3>
            <p style="color: #666; margin-bottom: 1rem;">לא מחובר? ניתן להזמין כאורח. מלא את הפרטים הבאים:</p>
            <div class="form-row">
                <div class="form-group">
                    <label for="guest_email">כתובת מייל *</label>
                    <input type="email" id="guest_email" name="guest_email" placeholder="your@email.com" required>
                </div>
                <div class="form-group">
                    <label for="guest_first_name">שם פרטי (באנגלית) *</label>
                    <input type="text" id="guest_first_name" name="guest_first_name" placeholder="First Name" required>
                </div>
                <div class="form-group">
                    <label for="guest_last_name">שם משפחה (באנגלית) *</label>
                    <input type="text" id="guest_last_name" name="guest_last_name" placeholder="Last Name" required>
                </div>
            </div>
            <p style="color: #666; font-size: 0.9rem;">* שמור את מספר ההזמנה שתקבל - תצטרך אותו כדי לצפות בכרטיסים או לבטל</p>
        </div>
        {% endif %}

        <button type="submit" class="btn-primary" id="submit-btn" disabled>
            המשך להזמנה
        </button>
    </form>
</div>

<script>
const form = document.getElementById('seat-selection-form');
const checkboxes = form.querySelectorAll('input[type="checkbox"]');
const selectedCount = document.getElementById('selected-count');
const totalPrice = document.getElementById('total-price');
const submitBtn = document.getElementById('submit-btn');

const businessPrice = {{ flight.price_business|int }};
const economyPrice = {{ flight.price_economy|int }};

function updateSummary() {
    let count = 0;
    let total = 0;

    checkboxes.forEach(checkbox => {
        if (checkbox.checked) {
            count++;
            const price = parseInt(checkbox.dataset.price);
            total += price;
        }
    });

    selectedCount.textContent = count;
    totalPrice.textContent = total.toFixed(2);
    submitBtn.disabled = count === 0;
}

checkboxes.forEach(checkbox => {
    checkbox.addEventListener('change', updateSummary);
});
</script>
{% endblock %}





